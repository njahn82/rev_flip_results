---
title: "Results Reverse Flips"
output:
  word_document: 
    keep_md: true
  fig_caption: yes
---

````{r, echo = FALSE, message = FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  fig.width = 6,
  fig.asp = 0.618,
  dpi = 300,
  fig.align = "center"
)
options(scipen = 999, digits = 2)
knitr::knit_hooks$set(inline = function(x) {
      if(is.numeric(x)){
          return(prettyNum(x, big.mark=","))
      }else{
          return(x)
       }
   })
# libraries
library(tidyverse)
#library(ggridges)
#library(ggpubr)
```

```{r data}
my_df <- readxl::read_xlsx("data/master_list.xlsx", sheet= 2) %>%
  mutate(issn = ifelse(issn == "0037-8615", "1405-213X", issn)) %>%
  # create id column
  mutate(id = paste(row.names(.), issn, sep = "/")) %>%
  rename(prev_pub = `prev. publisher`, born_oa = `Born OA`, flipped_oa = `Flipped OA`)
```

### Research Question 1: How many OA journals have reverse-flipped to a subscription model? 
 
We identified `r n_distinct(my_df$journal_name)` journals that converted from fully open access to a subscription model, including hybrid open access. While we discovered reverse-flips as early as 2005, the majority of journals changed their business model from 2013 onward (see Figure 3).


```{r time, fig.cap= "Number of journals converted from fully open access to a subscription-based business model per year."}
my_df %>%
  filter(!is.na(year_reverse_flipped)) %>%
  ggplot(aes(as.factor(year_reverse_flipped))) +
  geom_histogram(stat = "count") +
  theme_minimal() +
  labs(x = "Year of Reverse Flip", y = "Number of Journals") +
    theme_minimal(base_family="Roboto") +
  theme(plot.margin=margin(30,30,30,30)) +
  theme(panel.grid.minor=element_blank()) +
  theme(axis.ticks=element_blank()) +
  theme(panel.grid.major.x=element_blank()) +
  theme(panel.border=element_blank())
```

### Research Question 2: To provide a general overview,

#### a) How thoroughly are these journals currently indexed in major bibliometric databases (Web of Science, Scopus, PubMed)?
 
We investigated the coverage of reverse-flip journals in the following four major bibliometric databases: Crossref, a large DOI registration agency for scholarly works, Scopus, Journal Citation Report (JCR) listing journals indexed in the Web of Science, and MEDLINE. This analysis is based at the journal-level by matching ISSN variants. We used the most current available journal lists and search indexes at the time of our analysis in January 2019. 

```{r}
index_df <- readr::read_csv("data/indexing_coverage.csv")
```

In total, we found `r index_df %>% distinct(issn) %>% nrow()` journals that were indexed by at least one bibliometric databases examined, covering `r index_df %>% distinct(issn) %>% nrow() / nrow(my_df) * 100`% of the journals in our study. Figure presents the number of reverse-flip journals that were indexed by each database together with the intersections with the other databases using the UpSet technique (<https://doi.org/10.1093/bioinformatics/btx364>). 
Of the `r index_df %>% distinct(issn) %>% nrow()` reverse-flip journals, Crossref and Scopus covered most. Together with the Web of Science (JCR) they shared the largest number of journals (N = `r index_df %>% filter(source %in% c("Scopus", "Crossref", "JCR")) %>% group_by(issn) %>% filter(n() == 3) %>% distinct(issn) %>% nrow()`), of which `r index_df %>% filter(source %in% c("Scopus", "Crossref", "JCR", "MEDLINE")) %>% group_by(issn, source) %>% count() %>% ungroup() %>% group_by(issn) %>% count() %>% filter(nn == 4) %>% nrow()` journals were also indexed by MEDLINE.


```{r}
tt <- as.data.frame.matrix(table(index_df$issn, index_df$source))
library(UpSetR) # https://academic.oup.com/bioinformatics/article/33/18/2938/3884387
UpSetR::upset(tt, order.by = "freq")
```

#### b) How many articles did these journals publish between 2000 and 2018?

```{r}
cr_md <- readr::read_csv("data/cr_md.csv", col_types = cols(.default = "c")) %>%
  mutate(issued_year = lubridate::year(lubridate::parse_date_time(issued, c('y', 'ymd', 'ym'))))
cr_md %>%
  group_by(issn) %>% 
  summarise(volumes = n_distinct(issued_year), n = sum(n_distinct(DOI))) %>% 
  mutate(average = n / volumes) -> article_volume
```

To obtain the journal publication volume, we retrieved the metadata for all articles indexed in Crossref from the year 2000 onwards. Specifically, Crossref provided the metadata for `r n_distinct(cr_md$issn)` out of `r nrow(my_df)` journals (`r n_distinct(cr_md$issn) / nrow(my_df) * 100`% of our sample). Our analysis shows that between 2000 and 2018, these journals published `r nrow(cr_md)` articles, yet the yearly article volume varies considerably (see Figure 4), ranging from `r round(min(article_volume$average),0)` to `r round(max(article_volume$average),0)` with half of the journals publishing `r round(median(article_volume$average),0)` or fewer articles per year. 

```{r}
# article_volume %>%
#   summarise(Mean = mean(average),
#             Median = median(average),
#             `Standard Deviation` = sd(average),
#             `Minimum` = min(average),
#             `Maximum` = max(average),
#             `Q1` = quantile(average, 1/4),
#             `Q3` = quantile(average, 3/4)) %>%
# gather(1:7, key = " ", value = "Average Yearly Article Volume") %>%
#   knitr::kable(caption = "Summary statistics of yearly average publication volume per reverse flip journals. Publication volume for 142 journals was obtained using Crossref.", digits = 0)
```

```{r, fig.cap="Histogram of average journal size in terms of yearly article volume published. Red dashed line represents the median, yellow dashed lined the mean value of the distribution."}
article_volume %>%
  ggplot(aes(x = average)) +
  geom_histogram(bins = 15, fill="#56B4E9", alpha=0.5, color = "#56B4E9") +
  geom_vline(aes(xintercept = mean(average, na.rm = T)),
             colour = "#E69F00", linetype ="dashed", size = .8) +
  geom_vline(aes(xintercept = median(average, na.rm = T)),
             colour = "red", linetype ="dashed", size = .8) +
  theme_minimal() +
  labs(x = "Average Yearly Journal Volume", y = "Number of Journals") +
    theme_minimal(base_family="Roboto") +
  scale_x_continuous(breaks = c(0, 100, 200, 300, 400, 500, 600)) +
  theme(plot.margin=margin(30,30,30,30)) +
  theme(panel.grid.minor=element_blank()) +
  theme(axis.ticks=element_blank()) +
  theme(panel.grid.major.x=element_blank()) +
  theme(panel.border=element_blank())
```

#### c) To which academic disciplines do the journals belong to?

```{r}
cr_md <- readr::read_csv("data/cr_md.csv", col_types = cols(.default = "c")) %>%
  mutate(issued_year = lubridate::year(lubridate::parse_date_time(issued, c('y', 'ymd', 'ym'))))
cr_md %>%
  count(issn, issued_year) %>%
  left_join(my_df, by = c("issn")) %>%
  select(1:3, year_reverse_flipped) %>%
  filter(!is.na(year_reverse_flipped)) %>%
  mutate(lag = issued_year - year_reverse_flipped) %>%
  filter(lag %in% -2:2) -> tmp
tmp %>% 
  filter(lag %in% c(-2,2)) %>% 
  group_by(issn) %>% 
  filter(n() > 1) %>% 
  ungroup() %>% 
  group_by(lag) %>% 
  summarise(md = median(n)) -> median_change
```  

Table presents a breakdown by top-level discipline, highlighting that reverse flipped journal were not limited to one field, but could be found across various disciplines.

```{r}
my_df %>%
  count(Discipline) %>%
  mutate(prop = n / sum(n) * 100) %>%
  arrange(desc(prop)) %>%
  rbind(list("Total", nrow(my_df), 100)) %>%
  knitr::kable(col.names = c("Discipline", "Reverse-flip Journals", "Proportion (in %)"), digits = 2, caption = "Breakdown of reverse flip journals by discipline")
```


#### d) Under which publisher did the reverse-flip occur? Who does currently publish the journals?

To investigate the extent of reverse flips across different publishers, we acquired the publisher names for every journal at the time of the reverse flip and that of the most current volume. Table x shows the post-flip and current top  publishers based on the number of journals that were converted from fully OA to subscription access. These six publishers - Elsevier, Springer Nature, Taylor & Francis, De Gruyter, Brill and Wiley - comprised 105 journals at the time of the reverse-flip and 104 at the time of the most recent volume, representing around 70% of all reverse-flips journals investigated. The remaining publishers are categorized as "Other". The distribution of reverse flips across publishers resembles the general conditions of the scholarly publishing market at-large, which is also dominated by large commercial publishers like Elsevier, Springer Nature, Taylor and Francis, and Wiley.


```{r}
cr_md <- readr::read_csv("data/cr_md.csv", col_types = cols(.default = "c"))
cr_md %>%
  select(issn, issued, journal_title, publisher, DOI) %>%
  # issued to year
  # to year
  mutate(year = lubridate::parse_date_time(issued, c('y', 'ymd', 'ym'))) %>%
  mutate(year = lubridate::year(year)) %>%
  # filter latest year for every journal (issn)
  group_by(issn) %>%
  filter(year == max(year)) %>%
  ungroup() %>%
  # count articles per journal and publsiher name
  group_by(publisher, issn) %>%
  # get publisher with max article
  count() %>%
  ungroup() %>%
  group_by(issn) %>%
  filter(n == max(n)) %>%
  mutate(publisher = ifelse(publisher %in% "Springer Nature America, Inc", "Springer Nature", publisher)) %>%
  mutate(publisher = ifelse(publisher %in% "Brill Academic Publishers", "Brill", publisher)) %>%
  mutate(publisher = ifelse(publisher %in% "Informa UK Limited",
                            "Taylor & Francis", publisher)) %>%
  mutate(publisher = ifelse(publisher %in% "Walter de Gruyter GmbH",
                            "De Gruyter", publisher)) %>%
  mutate(publisher = gsub("Elsevier BV", "Elsevier", publisher)) %>%
  select(cr_publisher = publisher, issn) -> current_cr_publisher
my_df %>%
  select(issn, publisher) %>%
  left_join(current_cr_publisher, by = "issn") -> publisher_df
# backup
writexl::write_xlsx(publisher_df, "data/publisher_tmp.xlsx")
publisher_df %>%
  mutate(publisher = ifelse(publisher %in% "Brill Academic Publishers", "Brill", publisher)) %>%
  count(publisher, sort = TRUE) %>%
  mutate(publisher = forcats::as_factor(publisher)) %>%
  mutate(publisher = forcats::fct_other(publisher, drop = publisher[7:length(publisher)])) %>%
  group_by(publisher) %>%
  summarise(n_rev = sum(n)) -> rev_pub_count
publisher_df %>%
  mutate(cr_publisher = ifelse(is.na(cr_publisher), publisher, cr_publisher)) %>%
  count(cr_publisher, sort = TRUE) %>%
  mutate(cr_publisher = forcats::as_factor(cr_publisher)) %>%
  mutate(cr_publisher = forcats::fct_other(cr_publisher, drop = cr_publisher[7:length(cr_publisher)])) %>%
  group_by(cr_publisher) %>%
  summarise(n_cr = sum(n, na.rm = TRUE)) %>%
  inner_join(rev_pub_count, by = c("cr_publisher" = "publisher")) %>%
  mutate(n_cr_prop = n_cr / sum(n_cr)*100) %>%
  mutate(n_rev_prop = n_rev / sum(n_rev)*100) %>%
  mutate(cr_publisher = as.character(cr_publisher)) %>%
  rbind(list("Total", sum(.$n_cr), sum(.$n_rev),sum(.$n_cr_prop) ,sum(.$n_rev_prop))) %>%
  select(`Publisher` = cr_publisher, 
         `OA Journals converted to Toll-Access` = n_rev,
         `Proportion` = n_rev_prop,
         `Current number of reversely-flipped journals` = n_cr,
         `Proportion` = n_cr_prop) %>%
  knitr::kable()
```

#### e) How many journals have been associated with scholarly societies or academic institutions?

Our dataset contains information about whether reverse-flipped journals were related to scholarly societies and academic institutions. We obtained `r my_df %>% filter(society_affiliation == 1 | other_sci_affiliation == 1) %>% nrow()` (`r my_df %>% filter(society_affiliation == 1 | other_sci_affiliation == 1) %>% nrow() / nrow(my_df) * 100` %) reverse-flip journals that were either published together with a scholarly society (N = `r my_df %>% filter(society_affiliation == 1) %>% nrow()`) or at an academic institution (N = `r my_df %>% filter(other_sci_affiliation == 1) %>% nrow()`). 

Figure presents the extent to which journals were related to scholarly societies or academic institutions at the time of the reverse-flip. It shows that the majority of reverse-flip journals from major publishers were affiliated with professional associations and other research organisations.

```{r}
my_df %>%
    mutate(publisher = ifelse(publisher %in% "Brill Academic Publishers", "Brill", publisher)) %>%
  mutate(publisher = forcats::fct_lump(publisher, 6)) %>%
  mutate(relation = ifelse(society_affiliation == 0 & other_sci_affiliation == 1, "Institutional", NA)) %>%
  mutate(relation = ifelse(society_affiliation == 1 & other_sci_affiliation == 0, "Society", relation)) %>%
   mutate(relation = ifelse(society_affiliation == 0 & other_sci_affiliation == 0, "No relation", relation)) -> society_df
positions <- rev_pub_count$publisher

ggplot(society_df, aes (publisher, ..count.., 
                        fill = factor(relation, 
                                     c("Society", "Institutional", "No relation")))) +
  geom_bar(position = position_stack(reverse = TRUE)) +
  coord_flip() +
  scale_x_discrete(limits = rev(positions)) +
  scale_fill_manual("Relation",
                    values = c(
                      "Society" = "#23445D",
                      "Institutional" = "#AE4132",
                      "No relation" = "grey60")) +
  theme_minimal() +
  labs(y = "Reverse-flip Journals", x = "Publisher") +
  theme(plot.margin=margin(30,30,30,30)) +
  theme(panel.grid.minor=element_blank()) +
  theme(axis.ticks=element_blank()) +
  theme(panel.grid.major.y=element_blank()) +
  theme(panel.border=element_blank()) +
  theme(legend.position="top")
```

#### f) How old were the journals at the time of the reverse flip?

```{r}
my_df %>% 
  mutate(age_at_time_of_flip = year_reverse_flipped - year_founded) %>%
#  group_by(issn) %>%
  summarise(Mean = mean(age_at_time_of_flip),
            Median = median(age_at_time_of_flip),
            `Standard Deviation` = sd(age_at_time_of_flip),
            `Minimum` = min(age_at_time_of_flip),
            `Maximum` = max(age_at_time_of_flip),
            `Q1` = quantile(age_at_time_of_flip, 1/4),
            `Q3` = quantile(age_at_time_of_flip, 3/4)) -> age_df
```

Table provides summary statistics about the journal age at the year of the reverse flip. Large age differences can be observed, ranging from one year of existences to `r age_df$Maximum` years. Around `r round(filter(my_df, !is.na(year_founded), year_founded < 1990) %>% nrow() / nrow(my_df) * 100)`% (N = `r filter(my_df, !is.na(year_reverse_flipped), year_founded < 1990) %>% nrow()`) of all journals found started before 1990. These findings suggest that not all journals in our sample were born fully open access or online journals, but some might underwent more than one business model change in the course of history.

```{r}
age_df %>%
 gather(1:7, key = " ", value = "Journal Age in Years") %>%
 knitr::kable(digits = 0, caption = "Summary statistics for journal age at time of reverse flip")
```

Figure presents the number of journals converted from fully open access to a subscription-based business model per year grouped by journal age when the reverse flip happened.

```{r, fig.cap="Number of journals converted from fully open access to a subscription-based business model per year, grouped by journal age at time of reverse flip."}
my_df %>%
  mutate(age_at_time_of_flip = year_reverse_flipped - year_founded) %>%
  mutate(age_at_time_of_flip_cat = ifelse(age_at_time_of_flip < 6, "1-5", NA)) %>%
  mutate(age_at_time_of_flip_cat = ifelse(age_at_time_of_flip > 5, "6-15", age_at_time_of_flip_cat)) %>%
  mutate(age_at_time_of_flip_cat = ifelse(age_at_time_of_flip > 15, "> 15", age_at_time_of_flip_cat)) -> my_df_tt
ggplot(my_df_tt, aes(as.factor(year_reverse_flipped), 
                     fill = factor(age_at_time_of_flip_cat, levels = c("1-5", "6-15", "> 15")))) +
  geom_histogram(stat = "count") +
  scale_fill_manual("Journal Age at Year of Flip", values = c("#fcde9c","#e34f6f","#7c1d6f")) +
  theme_minimal() +
  labs(x = "Year of Reverse Flip", y = "Number of Journals") +
    theme_minimal(base_family="Roboto") +
  theme(plot.margin=margin(30,30,30,30)) +
  theme(panel.grid.minor=element_blank()) +
  theme(axis.ticks=element_blank()) +
  theme(panel.grid.major.x=element_blank()) +
  theme(panel.border=element_blank()) +
  theme(legend.position="top")
```

Figure presents a breakdown of discipline by journal age at the time of the reverse flip, shown as proportion of the total number of reverse flip journals in the dataset. The colored areas represent the distribution of journals per discipline. 


```{r, fig.cap='Discipline by journal age at the time of reverse flip, shown as proportion of the total number of reverse flip journals in the dataset. The colored areas represent the distribution of journals per Discipline.'}
# Motivation: https://serialmentor.com/dataviz/nested-proportions.html
my_df %>%
  mutate(age_at_time_of_flip = year_reverse_flipped - year_founded) %>%
  mutate(age_at_time_of_flip_cat = ifelse(age_at_time_of_flip < 6, "1-5", NA)) %>%
  mutate(age_at_time_of_flip_cat = ifelse(age_at_time_of_flip > 5, "6-15", age_at_time_of_flip_cat)) %>%
  mutate(age_at_time_of_flip_cat = ifelse(age_at_time_of_flip > 15, "> 15", age_at_time_of_flip_cat)) -> my_df_tt
year_all <- my_df_tt %>%
  count(age_at_time_of_flip_cat)
my_df_tt %>%
  count(age_at_time_of_flip_cat, Discipline) %>% 
ggplot(aes(x = factor(age_at_time_of_flip_cat, levels = c("1-5", "6-15", "> 15")), y = n)) +
  geom_bar(data = year_all, aes(fill = "All Reverse Flipped Journals"), color = "transparent", stat = "identity") +
  geom_bar(aes(fill = "per Discipline"), color = "transparent", stat = "identity") +
  facet_wrap(~Discipline, nrow = 1) +
  scale_fill_manual(values = c("#b3b3b3a0", "#56B4E9"), name = "") +
  theme_minimal() +
  labs(x = "Journal Age at Time of Flip", y = "Journals") +
  theme_minimal(base_family="Roboto") +
  theme(plot.margin=margin(30,30,30,30)) +
  theme(panel.grid.minor=element_blank()) +
  theme(axis.ticks=element_blank()) +
  theme(panel.grid.major.x=element_blank()) +
  theme(panel.border=element_blank()) +
  theme(legend.position = "top",
          legend.justification = "right")
```

It seems that for health and life sciences journals (Health) the majority of flips only happened after a period of establishing the journal (>15 years). However, for the physical sciences and mathematics (PSM) as well as the social sciences and humanities (SSH) this process of reconsidering the publishing model seems to have started earlier. For PSM journals about one third already flipped within the first five years of the journal’s lifetime. <!-- Overall, this may have resulted from a somewhat lower degree of acceptance of APC-based open access in these disciplines (add REF)-->



